pipeline {
agent any

tools {
maven "maven3.8.6"
}

parameters {
  choice choices: ['development', 'master', 'qa', 'uat'], name: 'brnachname'
}

stages{
     stage ('checkoutcode') {
     steps {
     slacknotification "STARTED"
      git branch: "${params.brnachname}", credentialsId: 'ff7d6067-3be9-4b9b-b1c9-a54a11c33b56', url: 'https://github.com/GodsEye-Org/maven-web-application.git'
     }
     }
     stage ('Build') {
     steps {
     sh "mvn clean package"
     }
     }
     stage ('Sonarqubereport') {
     steps {
     sh "mvn sonar:sonar"
     }
     }
     stage ('uploadtoNexusRepo') {
     steps {
     sh "mvn deploy"
     }
     }
     stage ('Tomcatserver') {
     steps {
     sshagent(['211021b8-30d4-4551-b080-009cd89e780d']){ 
     sh "scp -o StrictHostKeyChecking=no target/maven-web-application.war ec2-user@52.66.253.54:/opt/apache-tomcat-9.0.64/webapps/"
     }
     }
     }
} //stages closing

post {
  success {
    slacknotification(currentBuild.result)
  }
  failure {
    slacknotification(currentBuild.result)
  }
}

} //pipeline closing

 //slack notification block
    def slacknotification(String buildStatus = 'STARTED') {
 
  buildStatus =  buildStatus ?: 'SUCCESSFUL'

  // Default values
  def colorName = 'RED'
  def colorCode = '#FF0000'
  def subject = "${buildStatus}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'"
  def summary = "${subject} (${env.BUILD_URL})"

  // Override default values based on build status
  if (buildStatus == 'STARTED') {
    color = 'YELLOW'
    colorCode = '#FFFF00'
  } else if (buildStatus == 'SUCCESSFUL') {
    color = 'GREEN'
    colorCode = '#00FF00'
  } else {
    color = 'RED'
    colorCode = '#FF0000'
  }

  // Send notifications
  slackSend (color: colorCode, message: summary)
}

